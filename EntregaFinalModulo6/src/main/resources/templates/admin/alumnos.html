<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <th:block th:replace="~{fragments/header :: head}"/>
  <title>Gestión de Alumnos</title>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<div class="container my-5" role="main">
  <div th:replace="~{fragments/header :: alerts}"></div>

  <!-- Título y botón nuevo -->
  <div class="row mb-4 align-items-center">
    <div class="col">
      <h2 class="text-info">Gestión de Alumnos</h2>
    </div>
    <div class="col-auto" sec:authorize="hasRole('ROLE_ADMIN')">
      <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#alumnoModal">
        Nuevo Alumno
      </button>
    </div>
  </div>

  <!-- Tabla de alumnos -->
  <div class="materias-table p-4">
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
        <tr>
          <th>RUT</th>
          <th>Nombre</th>
          <th>Dirección</th>
          <th>Materias</th>
          <th>Fecha Registro</th>
          <th>Acciones</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${alumnos == null || alumnos.empty}">
          <td colspan="6" class="text-center">No hay alumnos registrados</td>
        </tr>
        <tr th:each="alumno : ${alumnos}">
          <td th:text="${alumno.rut}"></td>
          <td th:text="${alumno.nombre}"></td>
          <td th:text="${alumno.direccion}"></td>
          <td>
            <span class="badge bg-info" th:text="${alumno.materias.size()}">0</span>
          </td>
          <td th:text="${#temporals.format(alumno.createdAt, 'dd/MM/yyyy')}"></td>
          <td>
            <div class="btn-group">
              <button class="btn btn-sm btn-info" th:onclick="'editarAlumno(' + ${alumno.id} + ')'">
                Editar
              </button>
              <button class="btn btn-sm btn-danger" th:onclick="'eliminarAlumno(' + ${alumno.id} + ')'">
                Eliminar
              </button>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginación -->
    <nav th:if="${alumnos != null && alumnos.totalPages > 1}">
      <ul class="pagination justify-content-center">
        <li class="page-item" th:classappend="${alumnos.first} ? 'disabled'">
          <a class="page-link" th:href="@{/admin/alumnos(page=${alumnos.number - 1})}">Anterior</a>
        </li>
        <li class="page-item" th:each="pageNumber : ${#numbers.sequence(0, alumnos.totalPages - 1)}"
            th:classappend="${pageNumber == alumnos.number} ? 'active'">
          <a class="page-link" th:href="@{/admin/alumnos(page=${pageNumber})}"
             th:text="${pageNumber + 1}"></a>
        </li>
        <li class="page-item" th:classappend="${alumnos.last} ? 'disabled'">
          <a class="page-link" th:href="@{/admin/alumnos(page=${alumnos.number + 1})}">Siguiente</a>
        </li>
      </ul>
    </nav>
  </div>
</div>

<!-- Mantener los modales como estaban -->
<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>